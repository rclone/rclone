# Level3 Backend - Changelog

## [v1.1.0] - 2025-11-02

### üö® Critical Fixes

#### Fixed: Update Corruption (CRITICAL)
- **Issue**: Update operations could corrupt files when backend unavailable
- **Symptom**: `ERROR: invalid particle sizes: even=11, odd=14`
- **Impact**: Files became unreadable, data loss risk
- **Fix**: Added pre-flight health check before Update
- **Result**: Update now fails safely, original file preserved

#### Fixed: Move Creating Degraded Files
- **Issue**: Move operations created degraded files on retry
- **Symptom**: Moved file missing one particle
- **Impact**: Immediate degraded state, performance hit
- **Fix**: Added pre-flight health check before Move
- **Result**: Move now fails in degraded mode, file stays at original location

#### Fixed: Put Creating Degraded Files on Retry
- **Issue**: Put succeeded partially on retry attempts
- **Symptom**: New files created with missing particles
- **Impact**: Every new file required reconstruction
- **Fix**: Added pre-flight health check before Put
- **Result**: Put now fails immediately in degraded mode

---

### ‚úÖ New Features

#### Pre-flight Health Check
- Added `checkAllBackendsAvailable()` function
- Tests all 3 backends before write operations
- 5-second timeout (parallel checks)
- Clear error messages
- Overhead: +0.2 seconds (acceptable)

#### Strict Write Enforcement
- Put/Update/Move blocked in degraded mode
- Matches hardware RAID 3 behavior
- Prevents corruption from rclone's retry logic
- Error: "write blocked in degraded mode (RAID 3 policy)"

#### Update Particle Size Validation
- Validates particle sizes after Update
- Detects corruption if it occurs
- Returns detailed error message
- Defense-in-depth safety measure

---

### üìù Documentation Updates

#### Updated Files:
- `README.md` - Error handling section with health check details
- `RAID3.md` - Implementation details and fix explanation
- `ERROR_HANDLING_POLICY.md` - Official policy document
- `STRICT_WRITE_FIX.md` - Detailed fix documentation
- `MINIO_TEST_RESULTS_PHASE2.md` - Test results and findings

---

### üß™ Testing

#### New Tests (Phase 2):
- `TestPutFailsWithUnavailableBackend` - Verifies strict Put
- `TestDeleteSucceedsWithUnavailableBackend` - Verifies best-effort Delete
- `TestDeleteWithMissingParticles` - Verifies idempotent Delete
- `TestMoveWithMissingSourceParticle` - Move with degraded source
- `TestReadSucceedsWithUnavailableBackend` - Degraded mode reads

#### MinIO Interactive Tests:
- ‚úÖ Put fails fast with health check (~5s)
- ‚úÖ Update fails safely, preserves original (~5s)
- ‚úÖ Move fails safely, file unchanged (~15s, 3 attempts)
- ‚úÖ No corruption observed
- ‚úÖ No degraded files created

**All 28 automated tests passing** ‚úÖ

---

### ‚ö° Performance Impact

| Operation | Before Fix | After Fix | Change |
|-----------|------------|-----------|--------|
| Put (normal) | ~1s | ~1.2s | +0.2s (health check) |
| Put (degraded) | Variable (retry) | ~5s (fail fast) | Faster, safer |
| Update (normal) | ~1s | ~1.2s | +0.2s (health check) |
| Update (degraded) | üö® Corruption | ~5s (fail safe) | **Fixed!** |
| Move (normal) | ~1s | ~1.2s | +0.2s (health check) |
| Move (degraded) | Created degraded | ~5s (fail safe) | **Fixed!** |

---

### üéØ Production Readiness

**Before Fix**:
- ‚úÖ Local filesystems: Safe
- ‚ö†Ô∏è S3/MinIO (all up): Safe
- üö® S3/MinIO (degraded): **UNSAFE - Corruption risk**

**After Fix**:
- ‚úÖ Local filesystems: Safe
- ‚úÖ S3/MinIO (all up): Safe (+0.2s overhead)
- ‚úÖ S3/MinIO (degraded): **SAFE - Writes blocked**

**Status**: ‚úÖ **PRODUCTION READY FOR ALL SCENARIOS**

---

## [v1.0.0] - 2025-11-01

### Initial Release

#### Core Features
- ‚úÖ RAID 3 byte-level striping
- ‚úÖ XOR parity calculation
- ‚úÖ Three-backend architecture (even, odd, parity)
- ‚úÖ Degraded mode reads (2 of 3 backends)
- ‚úÖ Automatic parity reconstruction
- ‚úÖ Heal background uploads
- ‚úÖ S3/MinIO support with timeout modes
- ‚úÖ Comprehensive test suite (22 tests)

#### Known Issues (Fixed in v1.1.0):
- ‚ö†Ô∏è Update could corrupt files in degraded mode
- ‚ö†Ô∏è Move could create degraded files on retry
- ‚ö†Ô∏è Put could create degraded files on retry

---

## Migration Notes

### Upgrading to v1.1.0

**No breaking changes** - fully backward compatible

**New behavior**:
- Write operations now perform health check (+0.2s)
- Writes fail in degraded mode (previously could succeed partially)
- Clear error messages indicate RAID 3 policy enforcement

**If you were relying on degraded writes**:
- This was a bug, not a feature
- Could cause corruption
- Now properly blocked per RAID 3 spec

**Recommended action**: None - automatic improvement!

---

**Last Updated**: November 2, 2025

