#!/usr/bin/env python3
"""Dump protobuf bytes from Python's Google Photos API implementation"""

import sys
sys.path.insert(0, '/home/user/rclone')

from blackboxprotobuf import encode_message
from gphoto import message_types

# Get library state with empty token
proto_body = {
    "1": {
        "1": {
            "1": {
                "1": {},
                "3": {},
                "4": {},
                "5": {"1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "7": {}},
                "6": {},
                "7": {"2": {}},
                "15": {},
                "16": {},
                "17": {},
                "19": {},
                "20": {},
                "21": {"5": {"3": {}}, "6": {}},
                "25": {},
                "30": {"2": {}},
                "31": {},
                "32": {},
                "33": {"1": {}},
                "34": {},
                "36": {},
                "37": {},
                "38": {},
                "39": {},
                "40": {},
                "41": {},
            },
            "5": {
                "2": {
                    "2": {"3": {"2": {}}, "4": {"2": {}, "4": {}}},
                    "4": {"2": {"2": 1}},
                    "5": {"2": {}},
                    "6": 1,
                },
                "3": {
                    "2": {"3": {}, "4": {}},
                    "3": {"2": {}, "3": {"2": 1, "3": {}}},
                    "4": {},
                    "5": {"2": {"2": 1}},
                    "7": {},
                },
                "4": {"2": {"2": {}}},
                "5": {
                    "1": {
                        "2": {"3": {}, "4": {}},
                        "3": {"2": {}, "3": {"2": 1, "3": {}}},
                    },
                    "3": 1,
                },
            },
            "8": {},
            "9": {
                "2": {},
                "3": {"1": {}, "2": {}},
                "4": {
                    "1": {
                        "3": {
                            "1": {
                                "1": {"5": {"1": {}}, "6": {}, "7": {}},
                                "2": {},
                                "3": {
                                    "1": {"5": {"1": {}}, "6": {}, "7": {}},
                                    "2": {},
                                },
                            }
                        },
                        "4": {"1": {"2": {}}},
                    }
                },
            },
            "11": {"2": {}, "3": {}, "4": {"2": {"1": 1, "2": 2}}},
            "12": {},
            "14": {"2": {}, "3": {}, "4": {"2": {"1": 1, "2": 2}}},
            "15": {"1": {}, "4": {}},
            "17": {"1": {}, "4": {}},
            "19": {"2": {}, "3": {}, "4": {"2": {"1": 1, "2": 2}}},
            "21": {"1": {}},
            "22": {},
            "23": {},
            "24": {},
        },
        "2": {
            "1": {
                "2": {},
                "3": {},
                "4": {},
                "5": {},
                "6": {"1": {}, "2": {}, "3": {}, "4": {}, "5": {}, "7": {}},
                "7": {},
                "8": {},
                "10": {},
                "12": {},
                "13": {"2": {}, "3": {}},
                "15": {"1": {}},
                "18": {},
            },
            "4": {"1": {}},
            "9": {},
            "11": {"1": {"1": {}, "4": {}, "5": {}, "6": {}, "9": {}}},
            "14": {
                "1": {
                    "1": {
                        "1": {},
                        "2": {"2": {"1": {"1": {}}, "3": {}}},
                        "3": {
                            "4": {"1": {"1": {}}, "3": {}},
                            "5": {"1": {"1": {}}, "3": {}},
                        },
                    },
                    "2": {},
                }
            },
            "17": {},
            "18": {"1": {}, "2": {"1": {}}},
            "20": {"2": {"1": {}, "2": {}}},
            "22": {},
            "23": {},
            "24": {},
        },
        "3": {
            "2": {},
            "3": {
                "2": {},
                "3": {},
                "7": {},
                "8": {},
                "14": {"1": {}},
                "16": {},
                "17": {"2": {}},
                "18": {},
                "19": {},
                "20": {},
                "21": {},
                "22": {},
                "23": {},
                "27": {"1": {}, "2": {"1": {}}},
                "29": {},
                "30": {},
                "31": {},
                "32": {},
                "34": {},
                "37": {},
                "38": {},
                "39": {},
                "41": {},
                "43": {"1": {}},
                "45": {"1": {"1": {}}},
                "46": {"1": {}, "2": {}, "3": {}},
                "47": {},
            },
            "4": {"2": {}, "3": {"1": {}}, "4": {}, "5": {"1": {}}},
            "7": {},
            "12": {},
            "13": {},
            "14": {
                "1": {},
                "2": {"1": {}, "2": {"1": {}}, "3": {}, "4": {"1": {}}},
                "3": {"1": {}, "2": {"1": {}}, "3": {}, "4": {}},
            },
            "15": {},
            "16": {"1": {}},
            "18": {},
            "19": {
                "4": {"2": {}},
                "6": {"2": {}, "3": {}},
                "7": {"2": {}, "3": {}},
                "8": {},
                "9": {},
            },
            "20": {},
            "22": {},
            "24": {},
            "25": {},
            "26": {},
        },
        "6": "",  # state_token placeholder
        "7": 2,
        "9": {
            "1": {"2": {"1": {}, "2": {}}},
            "2": {"3": {"2": 1}},
            "3": {"2": {}},
            "4": {},
            "7": {"1": {}},
            "8": {"1": 2, "2": "\x01\x02\x03\x05\x06\x07"},
            "9": {},
            "11": {"1": {}},
        },
        "11": [1, 2, 6],
        "12": {"2": {"1": {}, "2": {}}, "3": {"1": {}}, "4": {}},
        "13": {},
        "15": {"3": {"1": 1}},
        "18": {
            "169945741": {
                "1": {
                    "1": {
                        "4": [2, 1, 6, 8, 10, 15, 18, 13, 17, 19, 14, 20],
                        "5": 6,
                        "6": 2,
                        "7": 1,
                        "8": 2,
                        "11": 3,
                        "12": 1,
                        "13": 3,
                        "15": 1,
                        "16": 1,
                        "17": 1,
                        "18": 2,
                    }
                }
            }
        },
        "19": {
            "1": {"1": {}, "2": {}},
            "2": {"1": [1, 2, 4, 6, 5, 7]},
            "3": {"1": {}, "2": {}},
            "5": {"1": {}, "2": {}},
            "6": {"1": {}},
            "7": {"1": {}, "2": {}},
            "8": {"1": {}},
        },
        "20": {
            "1": 1,
            "2": "",
            "3": {
                "1": "type.googleapis.com/photos.printing.client.PrintingPromotionSyncOptions",
                "2": {
                    "1": {
                        "4": [2, 1, 6, 8, 10, 15, 18, 13, 17, 19, 14, 20],
                        "5": 6,
                        "6": 2,
                        "7": 1,
                        "8": 2,
                        "11": 3,
                        "12": 1,
                        "13": 3,
                        "15": 1,
                        "16": 1,
                        "17": 1,
                        "18": 2,
                    }
                },
            },
        },
        "21": {
            "2": {"2": {"4": {}}, "4": {}, "5": {}},
            "3": {"2": {"1": 1}, "4": {"2": {}}},
            "5": {"1": {}},
            "6": {"1": {}, "2": {"1": {}}},
            "7": {
                "1": 2,
                "2": "\x01\x07\x08\t\n\r\x0e\x0f\x11\x13\x14\x16\x17-./01:\x06\x18267;>?@A89<GBED",
                "3": "\x01",
            },
            "8": {
                "3": {"1": {"1": {"2": {"1": 1}, "4": {"2": {}}}}, "3": {}},
                "4": {"1": {}},
                "5": {"1": {"2": {"1": 1}, "4": {"2": {}}}},
            },
            "9": {"1": {}},
            "10": {
                "1": {"1": {}},
                "3": {},
                "5": {},
                "6": {"1": {}},
                "7": {},
                "9": {},
                "10": {},
            },
            "11": {},
            "12": {},
            "13": {},
            "14": {},
            "16": {"1": {}},
        },
        "22": {"1": 1, "2": "107818234414673686888"},
        "25": {"1": {"1": {"1": {"1": {}}}}, "2": {}},
        "26": {},
    },
    "2": {"1": {"1": {"1": {"1": {}}, "2": {}}}, "2": {}},
}

print("Encoding get_library_state message...")
serialized_data = encode_message(proto_body, message_types.GET_LIB_STATE)

print(f"Generated {len(serialized_data)} bytes")
print("\n// Base64 encoded protobuf template for get_library_state")
import base64
print(f'const getLibraryStateTemplate = "{base64.b64encode(serialized_data).decode()}"')

print("\n// Raw hex dump:")
print(' '.join(f'{b:02x}' for b in serialized_data[:200]))
print(f"\n... ({len(serialized_data)} bytes total)")
